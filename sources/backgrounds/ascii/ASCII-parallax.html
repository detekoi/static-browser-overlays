<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Psychedelic ASCII â€” Parallax Restored</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#000;
      --weight:700;
      --ls:0.02em;
      --lh:0.78;
    }
    html, body{
      height:100%;
      margin:0;
      background:var(--bg);
      overflow:hidden;
    }
    .wrap{
      position:fixed;
      inset:0;
      pointer-events:none;
    }
    .container {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      animation: flow 90s linear infinite;
    }
    #container2 {
      animation-direction: reverse;
      animation-duration: 120s;
    }
    pre{
      margin:0;
      white-space:pre;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-weight:var(--weight);
      letter-spacing:var(--ls);
      line-height:var(--lh);
      background: linear-gradient(135deg,
        #2c2c2c, #4b3b47, #7a5c61, #a8896c, #d1c7b7, #a88fa0, #6b5c6e, #2c2c2c);
      background-size:200% 200%;
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      user-select:none;
      animation:
        drift-x 29s linear infinite,
        drift-y 31s linear infinite;
    }
    #bg2 {
        opacity: 0.6;
    }
    @keyframes drift-x { from { background-position-x: 0%; } to { background-position-x: 200%; } }
    @keyframes drift-y { from { background-position-y: 0%; } to { background-position-y: 200%; } }
    @keyframes flow {
        0% { transform: scale(1.1) translate(-10%, -10%); }
        25% { transform: scale(1.2) translate(10%, -10%); }
        50% { transform: scale(1.1) translate(10%, 10%); }
        75% { transform: scale(1.2) translate(-10%, 10%); }
        100% { transform: scale(1.1) translate(-10%, -10%); }
    }
    @media (prefers-reduced-motion: reduce){ .container, pre { animation:none !important; } }
  </style>
</head>
<body>
  <div class="wrap">
      <div class="container" id="container1">
        <pre id="bg1" aria-hidden="true"></pre>
      </div>
      <div class="container" id="container2">
        <pre id="bg2" aria-hidden="true"></pre>
      </div>
  </div>
  <script>
  (() => {
    const q = new URLSearchParams(location.search);
    const FONT_SIZE  = +(q.get('fs')      || 20);
    const DENSITY    = +(q.get('density') || 0.7);
    const RAMP = "@#%WM&8B$0X*+=-:.  ";
    const RAMP_LEN = RAMP.length - 1;
    const el1 = document.getElementById('bg1');
    const el2 = document.getElementById('bg2');

    el1.style.fontSize = FONT_SIZE + 'px';
    el2.style.fontSize = FONT_SIZE + 'px';

    function measure() {
      const s = document.createElement('span');
      s.textContent = 'M';
      const cs = getComputedStyle(el1);
      s.style.font = cs.font;
      s.style.lineHeight = cs.lineHeight;
      s.style.letterSpacing = cs.letterSpacing;
      s.style.position = 'absolute';
      s.style.visibility = 'hidden';
      document.body.appendChild(s);
      const r = s.getBoundingClientRect();
      s.remove();
      return {
        cw: Math.max(1, r.width  || FONT_SIZE * 0.6),
        ch: Math.max(1, r.height || FONT_SIZE * 0.9),
      };
    }

    function generateArt(cols, rows, seed) {
        const cx = cols * 0.5;
        const cy = rows * 0.5;
        const lines = new Array(rows);
        for (let y = 0; y < rows; y++) {
            const row = new Array(cols);
            const ny = (y - cy) / rows;
            for (let x = 0; x < cols; x++) {
                const nx = (x - cx) / cols;
                const r = Math.hypot(nx, ny);
                const a = Math.atan2(ny, nx);
                const raw_v = Math.sin(r * DENSITY * 8 + a * 4 + seed) + Math.sin(a * 8);
                const v = raw_v / 2.0;
                const ch = RAMP[ ((v + 1) * 0.5 * RAMP_LEN) | 0 ];
                row[x] = ch;
            }
            lines[y] = row.join('');
        }
        return lines.join('\n');
    }

    function setup() {
        const m = measure();
        
        // You can lower this value (e.g., to 1.1) to reduce resource usage,
        // at the risk of seeing the edges of the text during animation.
        const OVERFILL_FACTOR = 1.3;

        const cols = Math.ceil(Math.max(16, (window.innerWidth  / m.cw) * OVERFILL_FACTOR));
        const rows = Math.ceil(Math.max(16, (window.innerHeight / m.ch) * OVERFILL_FACTOR));

        const art1 = generateArt(cols, rows, 0);
        const art2 = generateArt(cols, rows, 100);
        el1.textContent = art1;
        el2.textContent = art2;
    }

    setup();
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(setup, 100);
    }, {passive:true});
  })();
  </script>
</body>
</html>